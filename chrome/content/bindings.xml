<?xml version="1.0"?>
<bindings
  xmlns="http://www.mozilla.org/xbl"
  xmlns:xbl="http://www.mozilla.org/xbl"
     xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
>
  

<binding id="swatchControl">
    <content>
        <xul:hbox
            align="end"
            anonid="container">
            <xul:box
                anonid="newColor"
                class="colorSwatch">
            </xul:box>
        </xul:hbox>
    </content>

    <implementation>
        <constructor><![CDATA[
            //Parent element for the whole control
            this.newColorBox = document.getAnonymousElementByAttribute(this, "anonid", "newColor");
            
            //Relate the parent swatch control to each
            //element in a way that doesn't depend
            //on traversing the DOM
            this.newColorBox.swatchControl = this;

            this.setSwatch(this.originalSwatch);
            
            this.swatch.addLiveColorObserver(this);
            this.swatch.addHistoryObserver(this);
            
        ]]></constructor>
        <method name="setSwatch">
            <parameter name="swatch"/>
            <body><![CDATA[
                this.swatch = swatch;
                
                var toolTip = "Found in " + swatch.count() + " style rule"
                        + (swatch.count()==1?"":"s");
                this.setAttribute("tooltiptext", toolTip);
                
                
                //Set up the modified swatch color box
                this.newColorBox.setAttribute(
                    "style",
                    "background-color: " + swatch.color.getCSSHex());
                
                //Set up the input box
                this.updateControl();
            ]]></body>
        </method>

        <method name="updateControl">
            <body><![CDATA[
                if (!this.swatch || !this.swatch.color){
                    return null;
                }
                
                this.updateColor(this.swatch.color)
            ]]>
            </body>
        </method>
        
        <method name="updateText">
            <body><![CDATA[
                if (!this.swatch || !this.swatch.color){
                    return null;
                }
            ]]>
            </body>
        </method>
        
        <method name="updateColor">
            <parameter name="color"/>
            <body><![CDATA[
                //The new color is different from the original color
                //Make the swatch the new background color
                this.newColorBox.setAttribute(
                    "style",
                    "background-color: " + color.getCSSHex());
            
            ]]>
            </body>
        </method>
        
        <method name="updateLiveColor">
            <parameter name="swatch"/>
            <body><![CDATA[
                this.updateColor(swatch.liveEditColor);
            ]]>
            </body>
        </method>
        
        <method name="updateSwatchHistory">
            <parameter name="swatch"/>
            <body><![CDATA[
            ]]>
            </body>
        </method>
        
    </implementation>

    <!-- We may need this later.
    <handlers>
        <handler event="mousedown" button="0"><![CDATA[
            alert("swatch event handler");
            event.stopPropagation();
            var target = event.target;
        ]]></handler>
    </handlers>-->
</binding>

</bindings>